# HiRAG é›†æˆåˆ° smart-rag éœ€æ±‚æ¸…å•

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

å°† HiRAGï¼ˆå±‚æ¬¡åŒ–çŸ¥è¯†æ£€ç´¢ï¼‰é›†æˆåˆ° smart-rag ç³»ç»Ÿä¸­ï¼Œè§£å†³å¤æ‚ç»“æ„åŒ–æ–‡æ¡£ï¼ˆæ”¿ç­–æ³•è§„ã€è´¢åŠ¡æŠ¥å‘Šç­‰ï¼‰çš„ä¸Šä¸‹æ–‡ç¢ç‰‡åŒ–ã€è¯­ä¹‰å…³è”ç¼ºå¤±ã€å±€éƒ¨ä¸å…¨å±€çŸ¥è¯†æ–­å±‚é—®é¢˜ã€‚

**é›†æˆæ–¹å¼**ï¼šé€‚é…å™¨æ¨¡å¼ - å¼•å…¥ HiRAG åº“ï¼Œé€šè¿‡é€‚é…å™¨åŒ…è£…é›†æˆï¼Œä¿æŒç°æœ‰æ¶æ„ä¸å˜ã€‚

---

## ğŸ” è®¾è®¡åæ€ä¸æ”¹è¿›ï¼ˆv2.0 æ›´æ–°ï¼‰

### æ ¸å¿ƒæ”¹è¿›ç‚¹

**1. æ¶æ„ä¼˜åŒ–**
- âŒ åŸè®¾è®¡ï¼šHiRAG ä½œä¸ºç‹¬ç«‹æ£€ç´¢æºï¼Œä¸å‘é‡/BM25 å¹¶è¡Œ
- âœ… æ–°è®¾è®¡ï¼šHiRAG ä½œä¸ºå¢å¼ºå±‚ï¼Œå¤ç”¨ç°æœ‰å‘é‡ç´¢å¼•ï¼Œåªç”Ÿæˆ global/bridge å±‚

**2. ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
- âŒ åŸè®¾è®¡ï¼šæš´éœ² 9+ ä¸ªé…ç½®é¡¹ï¼Œç”¨æˆ·éœ€æ‰‹åŠ¨é€‰æ‹©
- âœ… æ–°è®¾è®¡ï¼š**æ™ºèƒ½è·¯ç”±ç³»ç»Ÿ**ï¼Œæ ¹æ®æŸ¥è¯¢è‡ªåŠ¨åŒ¹é…æœ€ä½³ç­–ç•¥

**3. æ€§èƒ½ä¼˜åŒ–**
- âŒ åŸè®¾è®¡ï¼šåŒæ­¥é˜»å¡å¼ç´¢å¼•æ„å»º
- âœ… æ–°è®¾è®¡ï¼šå¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ— + å®æ—¶è¿›åº¦åé¦ˆ

**4. æˆæœ¬æ§åˆ¶**
- âŒ åŸè®¾è®¡ï¼šæœªé‡åŒ– LLM æˆæœ¬
- âœ… æ–°è®¾è®¡ï¼šæˆæœ¬ä¼°ç®— + é¢„ç®—æ§åˆ¶ + å®æ—¶ç›‘æ§

**5. æµ‹è¯•ä¿éšœ**
- âŒ åŸè®¾è®¡ï¼šç¼ºå°‘æµ‹è¯•ç­–ç•¥
- âœ… æ–°è®¾è®¡ï¼šå®Œæ•´æµ‹è¯•æ¡†æ¶ï¼ˆå•å…ƒæµ‹è¯• + Mock + æ€§èƒ½æµ‹è¯•ï¼‰

### å…³é”®æ–°å¢éœ€æ±‚

- **P0-0**: æ¶æ„é‡æ„ï¼ˆé¿å…ç´¢å¼•å†—ä½™ï¼‰
- **P0-5**: æ™ºèƒ½è·¯ç”±ç³»ç»Ÿï¼ˆè‡ªåŠ¨åŒ¹é…ç­–ç•¥ï¼‰â­ æ ¸å¿ƒåˆ›æ–°
- **P0-7**: å¼‚æ­¥ç´¢å¼•æ„å»ºï¼ˆåå°ä»»åŠ¡ï¼‰
- **P0-8**: æˆæœ¬æ§åˆ¶ä¸ç›‘æ§
- **P1-1**: æµ‹è¯•æ¡†æ¶ï¼ˆè´¨é‡ä¿éšœï¼‰

---

## ğŸ¯ P0 çº§éœ€æ±‚ï¼ˆæ ¸å¿ƒåŠŸèƒ½ - å¿…é¡»å®ç°ï¼‰

### P0-0: æ¶æ„é‡æ„ï¼ˆå‰ç½®ä»»åŠ¡ï¼‰
**ç›®æ ‡**ï¼šé‡æ–°è®¾è®¡ HiRAG é›†æˆæ–¹å¼ï¼Œé¿å…ç´¢å¼•å†—ä½™å’Œé‡å¤è®¡ç®—

**æ ¸å¿ƒé—®é¢˜**ï¼š
- HiRAG å†…éƒ¨ä½¿ç”¨å‘é‡æ£€ç´¢ï¼Œä¸ç°æœ‰ `vector_db.json` é‡å¤
- å­˜å‚¨ç©ºé—´ç¿»å€ï¼ŒåŒæ­¥å›°éš¾

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
é”™è¯¯æ¶æ„ï¼ˆå¹¶è¡Œï¼‰ï¼š
Vector â†’ Results â†˜
BM25   â†’ Results  â†’ èåˆ â†’ è¾“å‡º
HiRAG  â†’ Results â†—

æ­£ç¡®æ¶æ„ï¼ˆå¢å¼ºå±‚ï¼‰ï¼š
Vector + BM25 â†’ åŸºç¡€æ£€ç´¢ç»“æœï¼ˆlocal å±‚ï¼‰
       â†“
HiRAG å¢å¼ºï¼ˆæ·»åŠ  global + bridge å±‚ï¼‰
       â†“
èåˆè¾“å‡º
```

**è¯¦ç»†éœ€æ±‚**ï¼š
- ä¿®æ”¹ HiRAGRetrieverï¼Œå¤ç”¨ç°æœ‰ VectorRetriever çš„ç´¢å¼•
- HiRAG åªè´Ÿè´£ç”Ÿæˆå’Œç®¡ç† global/bridge çŸ¥è¯†
- è®¾è®¡ç»Ÿä¸€çš„çŸ¥è¯†å±‚æ¥å£ï¼š
  ```python
  class KnowledgeLayer(ABC):
      @abstractmethod
      def build(self, documents: List[str]) -> None:
          """æ„å»ºçŸ¥è¯†å±‚"""
          pass
      
      @abstractmethod
      def retrieve(self, query: str, top_k: int) -> List[Document]:
          """æ£€ç´¢çŸ¥è¯†"""
          pass
  
  class LocalKnowledgeLayer(KnowledgeLayer):
      """å¤ç”¨ç°æœ‰å‘é‡ç´¢å¼•"""
      def __init__(self, vector_retriever: VectorRetriever):
          self.retriever = vector_retriever
  
  class GlobalKnowledgeLayer(KnowledgeLayer):
      """æ–‡æ¡£çº§æ‘˜è¦"""
      pass
  
  class BridgeKnowledgeLayer(KnowledgeLayer):
      """æ¡¥æ¢çŸ¥è¯†"""
      pass
  ```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] ä¸åˆ›å»ºé‡å¤çš„å‘é‡ç´¢å¼•
- [ ] å­˜å‚¨ç©ºé—´å¢åŠ  < 30%ï¼ˆä»… global/bridgeï¼‰
- [ ] ä¸ç°æœ‰æ£€ç´¢æ— ç¼é›†æˆ
- [ ] æ¥å£æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•

**é¢„è®¡å·¥æ—¶**ï¼š1.5 å¤©

---

### P0-1: é…ç½®ç®¡ç†
**ç›®æ ‡**ï¼šåœ¨ `config.py` ä¸­æ·»åŠ  HiRAGConfig é…ç½®ç±»

**è¯¦ç»†éœ€æ±‚**ï¼š
- æ·»åŠ  `HiRAGConfig` dataclass
- åŒ…å«æ ¸å¿ƒé…ç½®é¡¹ï¼š
  - `enable_hierarchical`: å¯ç”¨å±‚æ¬¡åŒ–æ£€ç´¢
  - `enable_local/global/bridge`: ä¸‰å±‚çŸ¥è¯†å¼€å…³
  - `local_weight/global_weight/bridge_weight`: æƒé‡é…ç½®
  - `global_summary_max_tokens`: å…¨å±€æ‘˜è¦é•¿åº¦
  - `bridge_chunk_size/overlap`: æ¡¥æ¢çŸ¥è¯†åˆ†å—å‚æ•°
  - `fusion_strategy`: èåˆç­–ç•¥ï¼ˆweighted/rrf/maxï¼‰
- åœ¨ `RAGConfig` ä¸­é›†æˆ HiRAGConfig
- æ·»åŠ ä¾¿æ·è®¿é—®å‡½æ•° `get_hirag_config()`

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] é…ç½®ç±»å®šä¹‰å®Œæ•´
- [ ] å¯é€šè¿‡ `config.get_hirag_config()` è®¿é—®
- [ ] æ‰€æœ‰é…ç½®é¡¹æœ‰åˆç†é»˜è®¤å€¼å’Œæ³¨é‡Š

**é¢„è®¡å·¥æ—¶**ï¼š0.5 å¤©

---

### P0-2: HiRAG é€‚é…å™¨
**ç›®æ ‡**ï¼šåˆ›å»º `src/rag/retriever/hirag_retriever.py`ï¼Œå°è£… HiRAG åº“

**è¯¦ç»†éœ€æ±‚**ï¼š
- åˆ›å»º `HiRAGRetriever` ç±»ï¼Œç»§æ‰¿ `BaseRetriever`
- å®ç°æ ¸å¿ƒæ–¹æ³•ï¼š
  - `__init__(config, working_dir)`: åˆå§‹åŒ– HiRAG å®ä¾‹
  - `add_documents(texts)`: æ·»åŠ æ–‡æ¡£å¹¶æ„å»ºå±‚æ¬¡åŒ–ç´¢å¼•
  - `retrieve(query, top_k)`: æ‰§è¡Œå±‚æ¬¡åŒ–æ£€ç´¢
  - `retrieve_by_mode(query, mode, top_k)`: æ”¯æŒ hi/hi_local/hi_global/hi_bridge æ¨¡å¼
- è¿”å›ç»Ÿä¸€çš„ `Document` å¯¹è±¡ï¼ŒåŒ…å«å…ƒæ•°æ®ï¼š
  - `knowledge_type`: local/global/bridge
  - `confidence`: ç½®ä¿¡åº¦åˆ†æ•°
  - `source_info`: æ¥æºä¿¡æ¯

**æŠ€æœ¯è¦ç‚¹**ï¼š
```python
from hirag import HiRAG, QueryParam

class HiRAGRetriever(BaseRetriever):
    def __init__(self, config: HiRAGConfig, working_dir: str):
        self.hirag = HiRAG(
            working_dir=working_dir,
            enable_hierachical_mode=config.enable_hierarchical,
            enable_llm_cache=True
        )
    
    def retrieve(self, query: str, top_k: int) -> List[Document]:
        results = self.hirag.query(query, param=QueryParam(mode="hi"))
        return self._convert_to_documents(results)
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å¯æˆåŠŸåˆå§‹åŒ– HiRAG å®ä¾‹
- [ ] æ”¯æŒæ–‡æ¡£æ·»åŠ å’Œç´¢å¼•æ„å»º
- [ ] æ£€ç´¢è¿”å›æ ‡å‡† Document å¯¹è±¡
- [ ] æ”¯æŒå¤šç§æ£€ç´¢æ¨¡å¼

**é¢„è®¡å·¥æ—¶**ï¼š1 å¤©

---

### P0-3: å±‚æ¬¡åŒ–ç´¢å¼•å™¨
**ç›®æ ‡**ï¼šåˆ›å»º `src/rag/indexer/` æ¨¡å—ï¼Œç®¡ç† HiRAG ç´¢å¼•ç”Ÿå‘½å‘¨æœŸ

**è¯¦ç»†éœ€æ±‚**ï¼š
- åˆ›å»ºç›®å½•ç»“æ„ï¼š
  ```
  src/rag/indexer/
  â”œâ”€â”€ __init__.py
  â”œâ”€â”€ base.py              # ç´¢å¼•å™¨åŸºç±»
  â”œâ”€â”€ hierarchical_indexer.py  # HiRAG ç´¢å¼•å™¨
  â””â”€â”€ knowledge_builder.py     # çŸ¥è¯†å±‚æ„å»ºå™¨
  ```

- `HierarchicalIndexer` ç±»ï¼š
  - `build_index(documents)`: æ„å»ºå±‚æ¬¡åŒ–ç´¢å¼•
  - `update_index(new_documents)`: å¢é‡æ›´æ–°
  - `get_index_stats()`: è·å–ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯
  - `clear_index()`: æ¸…ç©ºç´¢å¼•

- `KnowledgeBuilder` ç±»ï¼š
  - `build_local_knowledge(chunks)`: æ„å»ºå±€éƒ¨çŸ¥è¯†
  - `build_global_knowledge(document)`: ç”Ÿæˆæ–‡æ¡£æ‘˜è¦
  - `build_bridge_knowledge(chunks)`: æ„å»ºæ¡¥æ¢çŸ¥è¯†

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ¨¡å—ç»“æ„æ¸…æ™°
- [ ] æ”¯æŒç´¢å¼•æ„å»ºå’Œæ›´æ–°
- [ ] å¯è·å–ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯
- [ ] ä¸ HiRAGRetriever æ— ç¼é…åˆ

**é¢„è®¡å·¥æ—¶**ï¼š1.5 å¤©

---

### P0-4: æ··åˆæ£€ç´¢æ‰©å±•
**ç›®æ ‡**ï¼šåœ¨ `hybrid_retrieval.py` ä¸­æ·»åŠ  HiRAG æ£€ç´¢æ¨¡å¼

**è¯¦ç»†éœ€æ±‚**ï¼š
- æ–°å¢å‡½æ•° `hirag_search(query, k, config)`: çº¯ HiRAG æ£€ç´¢
- æ–°å¢å‡½æ•° `hirag_hybrid_search(query, k, vector_weight, hirag_weight)`: HiRAG + ä¼ ç»Ÿæ··åˆæ£€ç´¢
- å®ç°ç»“æœèåˆç­–ç•¥ï¼š
  - åŠ æƒèåˆï¼ˆweightedï¼‰
  - å€’æ•°æ’åèåˆï¼ˆRRFï¼‰
  - æœ€å¤§å€¼èåˆï¼ˆmaxï¼‰
- æ”¯æŒè‡ªé€‚åº”è¿‡æ»¤

**æŠ€æœ¯è¦ç‚¹**ï¼š
```python
def hirag_hybrid_search(
    query: str, 
    k: int = 3,
    vector_weight: float = 0.3,
    bm25_weight: float = 0.2,
    hirag_weight: float = 0.5,
    use_adaptive_filter: bool = True
) -> List[Tuple[str, float]]:
    # 1. HiRAG æ£€ç´¢
    hirag_results = hirag_retriever.retrieve(query, k * 2)
    
    # 2. ä¼ ç»Ÿæ··åˆæ£€ç´¢
    hybrid_results = hybrid_search(query, k * 2, vector_weight/(vector_weight+bm25_weight))
    
    # 3. èåˆ
    fused = fuse_results(hirag_results, hybrid_results, [hirag_weight, 1-hirag_weight])
    
    # 4. è‡ªé€‚åº”è¿‡æ»¤
    if use_adaptive_filter:
        return adaptive_filter(fused, k)
    return fused[:k]
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ”¯æŒçº¯ HiRAG æ£€ç´¢
- [ ] æ”¯æŒ HiRAG + æ··åˆæ£€ç´¢
- [ ] å¤šç§èåˆç­–ç•¥å¯é€‰
- [ ] ä¸ç°æœ‰è‡ªé€‚åº”è¿‡æ»¤å…¼å®¹

**é¢„è®¡å·¥æ—¶**ï¼š1 å¤©

---

### P0-5: æ™ºèƒ½è·¯ç”±ç³»ç»Ÿï¼ˆæ ¸å¿ƒåˆ›æ–°ï¼‰â­
**ç›®æ ‡**ï¼šæ ¹æ®ç”¨æˆ·æŸ¥è¯¢è‡ªåŠ¨åŒ¹é…æœ€ä½³æ£€ç´¢ç­–ç•¥ï¼Œè§£å†³é…ç½®å¤æ‚åº¦é—®é¢˜

**èƒŒæ™¯é—®é¢˜**ï¼š
- ç°æœ‰ç³»ç»Ÿæœ‰ 10+ ç§æ£€ç´¢ä¼˜åŒ–é€‰é¡¹ï¼ˆHyDEã€å¤šå˜ä½“ã€æŸ¥è¯¢æ‰©å±•ã€HiRAG ç­‰ï¼‰
- ç”¨æˆ·ä¸çŸ¥é“è¯¥é€‰å“ªä¸ªï¼Œæ¯æ¬¡éƒ½è¦æ‰‹åŠ¨å‹¾é€‰
- é…ç½®é”™è¯¯å¯¼è‡´æ£€ç´¢æ•ˆæœå·®

**è§£å†³æ–¹æ¡ˆ**ï¼šæ™ºèƒ½è·¯ç”± - åˆ†ææŸ¥è¯¢ç‰¹å¾ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä½³ç­–ç•¥ç»„åˆ

**è¯¦ç»†éœ€æ±‚**ï¼š

1. **æŸ¥è¯¢åˆ†æå™¨**ï¼š
   ```python
   class QueryAnalyzer:
       def analyze(self, query: str) -> QueryProfile:
           """åˆ†ææŸ¥è¯¢ç‰¹å¾"""
           return QueryProfile(
               query_type='factual',      # factual/analytical/exploratory
               complexity='simple',        # simple/medium/complex
               length=len(query),
               has_multiple_questions=False,
               domain='policy',           # policy/financial/technical/general
               ambiguity_score=0.3,       # 0-1ï¼Œè¶Šé«˜è¶Šæ¨¡ç³Š
               requires_context=True
           )
   ```

2. **ç­–ç•¥è·¯ç”±å™¨**ï¼š
   ```python
   class StrategyRouter:
       def route(self, query_profile: QueryProfile) -> RetrievalStrategy:
           """æ ¹æ®æŸ¥è¯¢ç‰¹å¾è·¯ç”±åˆ°æœ€ä½³ç­–ç•¥"""
           
           # è§„åˆ™å¼•æ“
           if query_profile.query_type == 'factual' and query_profile.complexity == 'simple':
               # ç®€å•äº‹å®æŸ¥è¯¢ï¼šå‘é‡æ£€ç´¢å³å¯
               return RetrievalStrategy(
                   mode='vector',
                   enable_hyde=False,
                   enable_hirag=False
               )
           
           elif query_profile.query_type == 'analytical' and query_profile.requires_context:
               # åˆ†æå‹æŸ¥è¯¢ï¼Œéœ€è¦ä¸Šä¸‹æ–‡ï¼šå¯ç”¨ HiRAG
               return RetrievalStrategy(
                   mode='hirag_hybrid',
                   enable_hirag=True,
                   hirag_weights={'local': 0.3, 'global': 0.4, 'bridge': 0.3}
               )
           
           elif query_profile.ambiguity_score > 0.6:
               # æ¨¡ç³ŠæŸ¥è¯¢ï¼šå¯ç”¨ HyDE + å¤šå˜ä½“
               return RetrievalStrategy(
                   mode='hybrid_rerank',
                   enable_hyde=True,
                   enable_multi_variant=True
               )
           
           elif query_profile.has_multiple_questions:
               # å¤šé—®é¢˜ï¼šå¯ç”¨å¤šæ­¥éª¤æ£€ç´¢
               return RetrievalStrategy(
                   mode='hybrid_rerank',
                   enable_multi_step=True
               )
           
           # é»˜è®¤ï¼šæ··åˆæ£€ç´¢ + Rerank
           return RetrievalStrategy(mode='hybrid_rerank')
   ```

3. **ç­–ç•¥é¢„è®¾åº“**ï¼š
   ```python
   STRATEGY_PRESETS = {
       'quick': {
           'name': 'å¿«é€Ÿæ¨¡å¼',
           'description': 'ä¼˜å…ˆå“åº”é€Ÿåº¦ï¼Œé€‚åˆç®€å•æŸ¥è¯¢',
           'config': {'mode': 'vector', 'top_k': 3}
       },
       'balanced': {
           'name': 'å¹³è¡¡æ¨¡å¼',
           'description': 'é€Ÿåº¦ä¸è´¨é‡å¹³è¡¡ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯',
           'config': {'mode': 'hybrid_rerank', 'enable_adaptive_filter': True}
       },
       'accurate': {
           'name': 'ç²¾ç¡®æ¨¡å¼',
           'description': 'ä¼˜å…ˆå‡†ç¡®ç‡ï¼Œé€‚åˆå¤æ‚æŸ¥è¯¢',
           'config': {'mode': 'hirag_hybrid', 'enable_hirag': True, 'recall_k': 30}
       },
       'policy_analysis': {
           'name': 'æ”¿ç­–åˆ†ææ¨¡å¼',
           'description': 'ä¸“ä¸ºæ”¿ç­–æ–‡æ¡£ä¼˜åŒ–',
           'config': {
               'mode': 'hirag_hybrid',
               'enable_hirag': True,
               'hirag_weights': {'local': 0.3, 'global': 0.4, 'bridge': 0.3},
               'enable_section_hierarchy': True
           }
       }
   }
   ```

4. **UI é›†æˆ**ï¼š
   ```python
   # åœ¨ä¾§è¾¹æ æ·»åŠ æ¨¡å¼é€‰æ‹©
   st.subheader("ğŸ¯ æ£€ç´¢æ¨¡å¼")
   
   mode_selection = st.radio(
       "é€‰æ‹©æ¨¡å¼",
       ["æ™ºèƒ½è·¯ç”±ï¼ˆæ¨èï¼‰", "å¿«é€Ÿæ¨¡å¼", "å¹³è¡¡æ¨¡å¼", "ç²¾ç¡®æ¨¡å¼", "æ”¿ç­–åˆ†ææ¨¡å¼", "è‡ªå®šä¹‰"],
       help="æ™ºèƒ½è·¯ç”±ä¼šæ ¹æ®æ‚¨çš„é—®é¢˜è‡ªåŠ¨é€‰æ‹©æœ€ä½³ç­–ç•¥"
   )
   
   if mode_selection == "æ™ºèƒ½è·¯ç”±ï¼ˆæ¨èï¼‰":
       st.info("ğŸ¤– ç³»ç»Ÿå°†è‡ªåŠ¨åˆ†ææ‚¨çš„é—®é¢˜ï¼Œé€‰æ‹©æœ€ä½³æ£€ç´¢ç­–ç•¥")
       
       # æ˜¾ç¤ºä¸Šæ¬¡è·¯ç”±å†³ç­–ï¼ˆå¯é€‰ï¼‰
       if st.session_state.get('last_routing_decision'):
           with st.expander("æŸ¥çœ‹è·¯ç”±å†³ç­–"):
               decision = st.session_state.last_routing_decision
               st.write(f"**æŸ¥è¯¢ç±»å‹**: {decision['query_type']}")
               st.write(f"**å¤æ‚åº¦**: {decision['complexity']}")
               st.write(f"**é€‰æ‹©ç­–ç•¥**: {decision['strategy']}")
               st.write(f"**åŸå› **: {decision['reason']}")
   
   elif mode_selection == "è‡ªå®šä¹‰":
       # æ˜¾ç¤ºæ‰€æœ‰é«˜çº§é€‰é¡¹
       show_advanced_options()
   else:
       # åº”ç”¨é¢„è®¾é…ç½®
       apply_preset(mode_selection)
   ```

5. **è·¯ç”±æ—¥å¿—ä¸ä¼˜åŒ–**ï¼š
   ```python
   class RoutingLogger:
       def log_decision(self, query, profile, strategy, result_quality):
           """è®°å½•è·¯ç”±å†³ç­–å’Œç»“æœè´¨é‡"""
           self.logs.append({
               'query': query,
               'profile': profile,
               'strategy': strategy,
               'quality': result_quality,
               'timestamp': datetime.now()
           })
       
       def analyze_performance(self):
           """åˆ†æè·¯ç”±æ€§èƒ½ï¼Œä¼˜åŒ–è§„åˆ™"""
           # ç»Ÿè®¡å„ç­–ç•¥çš„å¹³å‡è´¨é‡
           # å‘ç°ä½æ•ˆè§„åˆ™
           # ç”Ÿæˆä¼˜åŒ–å»ºè®®
           pass
   ```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æŸ¥è¯¢åˆ†æå™¨å‡†ç¡®è¯†åˆ«æŸ¥è¯¢ç±»å‹ï¼ˆå‡†ç¡®ç‡ > 85%ï¼‰
- [ ] è·¯ç”±å†³ç­–åˆç†ï¼ˆç”¨æˆ·æ»¡æ„åº¦ > 80%ï¼‰
- [ ] UI ç®€æ´ï¼Œé»˜è®¤åªæ˜¾ç¤ºæ¨¡å¼é€‰æ‹©
- [ ] æ”¯æŒæŸ¥çœ‹è·¯ç”±å†³ç­–è¿‡ç¨‹
- [ ] è®°å½•è·¯ç”±æ—¥å¿—ï¼Œæ”¯æŒåç»­ä¼˜åŒ–
- [ ] ç›¸æ¯”æ‰‹åŠ¨é…ç½®ï¼Œç”¨æˆ·æ“ä½œæ­¥éª¤å‡å°‘ 80%+

**é¢„è®¡å·¥æ—¶**ï¼š2 å¤©

---

### P0-6: UI ç®€åŒ–ä¸ä¼˜åŒ–
**ç›®æ ‡**ï¼šç®€åŒ–ç”¨æˆ·ç•Œé¢ï¼Œé™ä½ä½¿ç”¨é—¨æ§›

**è¯¦ç»†éœ€æ±‚**ï¼š
- åœ¨æ£€ç´¢æ¨¡å¼ radio ä¸­æ·»åŠ é€‰é¡¹ï¼š
  - "HiRAG å±‚æ¬¡åŒ–æ£€ç´¢ ğŸ†•"
  - "HiRAG + æ··åˆæ£€ç´¢ï¼ˆæ¨èï¼‰ğŸŒŸ"
- å½“é€‰æ‹© HiRAG æ¨¡å¼æ—¶ï¼Œæ˜¾ç¤ºé…ç½®é¢æ¿ï¼š
  ```python
  st.subheader("ğŸ—ï¸ å±‚æ¬¡åŒ–çŸ¥è¯†é…ç½®")
  
  col1, col2, col3 = st.columns(3)
  with col1:
      enable_local = st.checkbox("å±€éƒ¨çŸ¥è¯†", value=True)
  with col2:
      enable_global = st.checkbox("å…¨å±€çŸ¥è¯†", value=True)
  with col3:
      enable_bridge = st.checkbox("æ¡¥æ¢çŸ¥è¯†", value=True)
  
  with st.expander("âš™ï¸ é«˜çº§ï¼šçŸ¥è¯†å±‚æƒé‡"):
      local_weight = st.slider("å±€éƒ¨æƒé‡", 0.0, 1.0, 0.4, 0.1)
      global_weight = st.slider("å…¨å±€æƒé‡", 0.0, 1.0, 0.3, 0.1)
      bridge_weight = st.slider("æ¡¥æ¢æƒé‡", 0.0, 1.0, 0.3, 0.1)
  ```
- æ·»åŠ é…ç½®è¯´æ˜å’Œå¸®åŠ©ä¿¡æ¯
- ä¿å­˜é…ç½®åˆ° session_state

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ£€ç´¢æ¨¡å¼ä¸­æœ‰ HiRAG é€‰é¡¹
- [ ] é…ç½®ç•Œé¢å‹å¥½ç›´è§‚
- [ ] æƒé‡æ€»å’Œæ ¡éªŒï¼ˆåº”ä¸º 1.0ï¼‰
- [ ] é…ç½®æ­£ç¡®ä¿å­˜åˆ° session_state

**é¢„è®¡å·¥æ—¶**ï¼š0.5 å¤©

---

### P0-7: å¼‚æ­¥ç´¢å¼•æ„å»º
**ç›®æ ‡**ï¼šåå°å¼‚æ­¥æ„å»ºç´¢å¼•ï¼Œé¿å…é˜»å¡ç”¨æˆ·æ“ä½œ

**æ ¸å¿ƒé—®é¢˜**ï¼š
- å¤§æ–‡æ¡£ï¼ˆ>10MBï¼‰ç´¢å¼•æ„å»ºå¯èƒ½éœ€è¦æ•°åˆ†é’Ÿ
- åŒæ­¥æ„å»ºä¼šé˜»å¡ UIï¼Œç”¨æˆ·ä½“éªŒå·®
- ç”¨æˆ·æ— æ³•å–æ¶ˆæˆ–æŸ¥çœ‹è¯¦ç»†è¿›åº¦

**è§£å†³æ–¹æ¡ˆ**ï¼šåå°ä»»åŠ¡é˜Ÿåˆ— + å®æ—¶è¿›åº¦åé¦ˆ

**è¯¦ç»†éœ€æ±‚**ï¼š

1. **ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿ**ï¼š
   ```python
   from queue import Queue
   from threading import Thread
   
   class IndexingTaskQueue:
       def __init__(self):
           self.queue = Queue()
           self.worker = Thread(target=self._process_queue, daemon=True)
           self.worker.start()
       
       def submit(self, task: IndexingTask) -> str:
           """æäº¤ç´¢å¼•ä»»åŠ¡ï¼Œè¿”å›ä»»åŠ¡ID"""
           task_id = generate_task_id()
           self.queue.put((task_id, task))
           return task_id
       
       def get_status(self, task_id: str) -> TaskStatus:
           """æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€"""
           return TaskStatus(
               status='running',  # pending/running/completed/failed
               progress=0.65,
               current_step='ç”Ÿæˆå…¨å±€æ‘˜è¦',
               estimated_time_remaining=120
           )
       
       def cancel(self, task_id: str):
           """å–æ¶ˆä»»åŠ¡"""
           pass
   ```

2. **UI é›†æˆ**ï¼š
   ```python
   # æ–‡ä»¶ä¸Šä¼ å
   if uploaded_file:
       # ç«‹å³è¿”å›ï¼Œåå°æ„å»º
       task_id = indexing_queue.submit(IndexingTask(
           file=uploaded_file,
           config=hirag_config
       ))
       
       st.success(f"âœ… æ–‡ä»¶å·²ä¸Šä¼ ï¼ç´¢å¼•æ­£åœ¨åå°æ„å»º...")
       st.info(f"ğŸ“‹ ä»»åŠ¡ID: {task_id}")
       
       # æ˜¾ç¤ºå®æ—¶è¿›åº¦
       progress_placeholder = st.empty()
       status_placeholder = st.empty()
       
       while True:
           status = indexing_queue.get_status(task_id)
           
           if status.status == 'completed':
               progress_placeholder.progress(1.0)
               status_placeholder.success("âœ… ç´¢å¼•æ„å»ºå®Œæˆï¼")
               break
           elif status.status == 'failed':
               status_placeholder.error(f"âŒ æ„å»ºå¤±è´¥: {status.error}")
               break
           else:
               progress_placeholder.progress(status.progress)
               status_placeholder.info(
                   f"â³ {status.current_step} "
                   f"(é¢„è®¡å‰©ä½™ {status.estimated_time_remaining}s)"
               )
               time.sleep(1)
   ```

3. **é™çº§ç­–ç•¥**ï¼š
   ```python
   # æ„å»ºæœŸé—´ï¼Œç”¨æˆ·å¯ä»¥å…ˆä½¿ç”¨ä¼ ç»Ÿæ£€ç´¢
   if is_indexing(task_id):
       st.warning("âš ï¸ HiRAG ç´¢å¼•æ­£åœ¨æ„å»ºä¸­ï¼Œå½“å‰ä½¿ç”¨ä¼ ç»Ÿæ£€ç´¢")
       # è‡ªåŠ¨é™çº§åˆ°æ··åˆæ£€ç´¢
       retrieval_mode = 'hybrid_rerank'
   ```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] ä¸Šä¼ åç«‹å³è¿”å›ï¼Œä¸é˜»å¡ UI
- [ ] å®æ—¶æ˜¾ç¤ºæ„å»ºè¿›åº¦ï¼ˆæ›´æ–°é¢‘ç‡ 1sï¼‰
- [ ] æ”¯æŒå–æ¶ˆä»»åŠ¡
- [ ] æ„å»ºæœŸé—´å¯ä½¿ç”¨é™çº§æ£€ç´¢
- [ ] æ„å»ºå¤±è´¥æœ‰è¯¦ç»†é”™è¯¯ä¿¡æ¯

**é¢„è®¡å·¥æ—¶**ï¼š1.5 å¤©

---

### P0-8: æˆæœ¬æ§åˆ¶ä¸ç›‘æ§
**ç›®æ ‡**ï¼šé‡åŒ–å’Œæ§åˆ¶ LLM è°ƒç”¨æˆæœ¬

**æ ¸å¿ƒé—®é¢˜**ï¼š
- HiRAG éœ€è¦ LLM ç”Ÿæˆ global/bridge çŸ¥è¯†ï¼Œæˆæœ¬ä¸å¯æ§
- ç”¨æˆ·ä¸çŸ¥é“ç´¢å¼•æ„å»ºä¼šèŠ±è´¹å¤šå°‘é’±
- æ²¡æœ‰é¢„ç®—é™åˆ¶ï¼Œå¯èƒ½è¶…æ”¯

**è§£å†³æ–¹æ¡ˆ**ï¼šæˆæœ¬ä¼°ç®— + é¢„ç®—æ§åˆ¶ + å®æ—¶ç›‘æ§

**è¯¦ç»†éœ€æ±‚**ï¼š

1. **æˆæœ¬ä¼°ç®—å™¨**ï¼š
   ```python
   class CostEstimator:
       def estimate_indexing_cost(self, documents: List[str], config: HiRAGConfig) -> float:
           """ä¼°ç®—ç´¢å¼•æ„å»ºæˆæœ¬ï¼ˆç¾å…ƒï¼‰"""
           total_tokens = 0
           
           # Global æ‘˜è¦æˆæœ¬
           if config.enable_global:
               for doc in documents:
                   input_tokens = len(doc) / 4  # ç²—ç•¥ä¼°ç®—
                   output_tokens = config.global_summary_max_tokens
                   total_tokens += input_tokens + output_tokens
           
           # Bridge çŸ¥è¯†æˆæœ¬
           if config.enable_bridge:
               total_tokens += estimate_bridge_tokens(documents)
           
           # æŒ‰ä»·æ ¼è®¡ç®—ï¼ˆå‡è®¾ $0.001/1K tokensï¼‰
           cost = total_tokens / 1000 * 0.001
           return cost
   ```

2. **é¢„ç®—æ§åˆ¶**ï¼š
   ```python
   @dataclass
   class HiRAGConfig:
       # æˆæœ¬æ§åˆ¶
       max_cost_per_document: float = 0.1  # ç¾å…ƒ
       max_total_cost: float = 10.0
       enable_cost_alert: bool = True
       cost_alert_threshold: float = 5.0
   
   # æ„å»ºå‰æ£€æŸ¥é¢„ç®—
   estimated_cost = estimator.estimate_indexing_cost(documents, config)
   if estimated_cost > config.max_total_cost:
       raise BudgetExceededError(
           f"é¢„ä¼°æˆæœ¬ ${estimated_cost:.2f} è¶…è¿‡é¢„ç®— ${config.max_total_cost:.2f}"
       )
   ```

3. **UI å±•ç¤º**ï¼š
   ```python
   # ä¸Šä¼ æ–‡ä»¶åæ˜¾ç¤ºæˆæœ¬ä¼°ç®—
   estimated_cost = estimate_cost(uploaded_file)
   
   st.warning(f"""
   ğŸ’° **æˆæœ¬ä¼°ç®—**
   - é¢„ä¼°ç´¢å¼•æˆæœ¬ï¼š${estimated_cost:.2f}
   - å½“å‰é¢„ç®—ï¼š${config.max_total_cost:.2f}
   - å‰©ä½™é¢„ç®—ï¼š${config.max_total_cost - current_usage:.2f}
   """)
   
   if st.button("ç¡®è®¤æ„å»º"):
       # å¼€å§‹æ„å»º
       pass
   ```

4. **å®æ—¶ç›‘æ§**ï¼š
   ```python
   # åœ¨ä¾§è¾¹æ æ˜¾ç¤ºæˆæœ¬ç»Ÿè®¡
   st.sidebar.subheader("ğŸ’° æˆæœ¬ç»Ÿè®¡")
   col1, col2 = st.sidebar.columns(2)
   with col1:
       st.metric("æœ¬æœˆæ¶ˆè€—", f"${monthly_cost:.2f}")
   with col2:
       st.metric("å‰©ä½™é¢„ç®—", f"${remaining_budget:.2f}")
   
   # æˆæœ¬è¶‹åŠ¿å›¾
   st.sidebar.line_chart(cost_history)
   ```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æˆæœ¬ä¼°ç®—è¯¯å·® < 20%
- [ ] è¶…é¢„ç®—æ—¶é˜»æ­¢æ„å»º
- [ ] UI æ¸…æ™°å±•ç¤ºæˆæœ¬ä¿¡æ¯
- [ ] å®æ—¶ç›‘æ§æˆæœ¬æ¶ˆè€—
- [ ] æ”¯æŒè®¾ç½®é¢„ç®—å‘Šè­¦

**é¢„è®¡å·¥æ—¶**ï¼š1 å¤©

---

### P0-9: æ£€ç´¢ç»“æœå±•ç¤ºä¼˜åŒ–
**ç›®æ ‡**ï¼šç®€æ´å±•ç¤ºæ£€ç´¢ç»“æœï¼Œé¿å…ä¿¡æ¯è¿‡è½½

**æ ¸å¿ƒé—®é¢˜**ï¼š
- åŸè®¾è®¡ä¸ºæ¯ä¸ªç»“æœå±•ç¤ºçŸ¥è¯†ç±»å‹ã€åˆ†æ•°ã€æ¥æºç­‰ï¼Œä¿¡æ¯è¿‡è½½
- ç”¨æˆ·åªæƒ³å¿«é€Ÿè·å–ç­”æ¡ˆï¼Œä¸å…³å¿ƒæŠ€æœ¯ç»†èŠ‚

**è§£å†³æ–¹æ¡ˆ**ï¼šç®€æ´æ¨¡å¼ + è¯¦ç»†æ¨¡å¼åˆ‡æ¢

**è¯¦ç»†éœ€æ±‚**ï¼š

1. **ç®€æ´æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰**ï¼š
   ```python
   # åªæ˜¾ç¤ºç­”æ¡ˆå’Œå…³é”®æ¥æº
   st.markdown("### ğŸ’¬ å›ç­”")
   st.write(answer)
   
   with st.expander("ğŸ“š å‚è€ƒæ¥æº"):
       for i, (chunk, score) in enumerate(top_3_chunks):
           st.markdown(f"**æ¥æº {i+1}** (ç›¸å…³åº¦: {score:.2f})")
           st.caption(chunk[:150] + "...")
   ```

2. **è¯¦ç»†æ¨¡å¼**ï¼š
   ```python
   # æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯
   for i, (chunk, score) in enumerate(retrieved_chunks):
       knowledge_type = chunk_metadata.get('knowledge_type', 'local')
       
       icon = {'local': 'ğŸ“„', 'global': 'ğŸŒ', 'bridge': 'ğŸŒ‰'}.get(knowledge_type, 'ğŸ“„')
       
       with st.expander(f"{icon} æ¥æº {i+1} - {knowledge_type.upper()} (ç›¸å…³åº¦: {score:.3f})"):
           st.write(chunk)
           st.caption(f"ğŸ“ {chunk_metadata.get('section_path', 'N/A')}")
   ```

3. **æ¨¡å¼åˆ‡æ¢**ï¼š
   ```python
   display_mode = st.radio("æ˜¾ç¤ºæ¨¡å¼", ["ç®€æ´", "è¯¦ç»†"], horizontal=True)
   ```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] é»˜è®¤ç®€æ´æ¨¡å¼ï¼Œä¿¡æ¯æ¸…æ™°
- [ ] å¯åˆ‡æ¢åˆ°è¯¦ç»†æ¨¡å¼
- [ ] è¯¦ç»†æ¨¡å¼æ ‡æ³¨çŸ¥è¯†å±‚çº§
- [ ] ç•Œé¢ç¾è§‚ï¼Œä¸æ‹¥æŒ¤

**é¢„è®¡å·¥æ—¶**ï¼š0.5 å¤©

**P0 æ€»è®¡å·¥æ—¶**ï¼š9.5 å¤©**ï¼ˆè¾ƒåŸç‰ˆå¢åŠ  4 å¤©ï¼Œä¸»è¦ç”¨äºæ¶æ„é‡æ„ã€æ™ºèƒ½è·¯ç”±ã€å¼‚æ­¥æ„å»ºã€æˆæœ¬æ§åˆ¶ï¼‰

---

## ğŸš€ P1 çº§éœ€æ±‚ï¼ˆé‡è¦ä¼˜åŒ– - å»ºè®®å®ç°ï¼‰

### P1-1: æµ‹è¯•æ¡†æ¶ï¼ˆè´¨é‡ä¿éšœï¼‰
**ç›®æ ‡**ï¼šå»ºç«‹å®Œæ•´çš„æµ‹è¯•ä½“ç³»ï¼Œç¡®ä¿ä»£ç è´¨é‡

**æ ¸å¿ƒé—®é¢˜**ï¼š
- åŸéœ€æ±‚æ¸…å•ç¼ºå°‘æµ‹è¯•ç­–ç•¥
- HiRAG é›†æˆæ¶‰åŠå¤šä¸ªæ¨¡å—ï¼Œå®¹æ˜“å¼•å…¥ bug
- LLM è°ƒç”¨æˆæœ¬é«˜ï¼Œéœ€è¦ Mock æœºåˆ¶

**è§£å†³æ–¹æ¡ˆ**ï¼šå•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + Mock + æ€§èƒ½æµ‹è¯•

**è¯¦ç»†éœ€æ±‚**ï¼š

1. **å•å…ƒæµ‹è¯•**ï¼ˆè¦†ç›–ç‡ > 80%ï¼‰ï¼š
   ```python
   # tests/test_hirag_retriever.py
   def test_hirag_retriever_init():
       """æµ‹è¯• HiRAG æ£€ç´¢å™¨åˆå§‹åŒ–"""
       config = HiRAGConfig()
       retriever = HiRAGRetriever(config, "./test_dir")
       assert retriever is not None
   
   def test_knowledge_layer_build():
       """æµ‹è¯•çŸ¥è¯†å±‚æ„å»º"""
       layer = GlobalKnowledgeLayer()
       layer.build(["test document"])
       assert layer.get_stats()['total_docs'] == 1
   ```

2. **LLM Mock æœºåˆ¶**ï¼š
   ```python
   # tests/mocks/llm_mock.py
   class MockLLMClient:
       def embeddings_create(self, input, model):
           """Mock embedding è°ƒç”¨"""
           return MockEmbeddingResponse([
               [0.1] * 1536 for _ in input
           ])
       
       def chat_completions_create(self, messages, model):
           """Mock chat è°ƒç”¨"""
           return MockChatResponse("è¿™æ˜¯ä¸€ä¸ª mock æ‘˜è¦")
   
   # ä½¿ç”¨ Mock
   @pytest.fixture
   def mock_llm():
       with patch('openai.OpenAI', return_value=MockLLMClient()):
           yield
   ```

3. **é›†æˆæµ‹è¯•**ï¼š
   ```python
   def test_end_to_end_hirag_pipeline(mock_llm):
       """ç«¯åˆ°ç«¯æµ‹è¯•ï¼šä¸Šä¼ æ–‡æ¡£ -> æ„å»ºç´¢å¼• -> æ£€ç´¢"""
       # 1. ä¸Šä¼ æ–‡æ¡£
       indexer = HierarchicalIndexer(config)
       indexer.build_index(["æ”¿ç­–æ–‡æ¡£å†…å®¹..."])
       
       # 2. æ£€ç´¢
       retriever = HiRAGRetriever(config)
       results = retriever.retrieve("æŸ¥è¯¢é—®é¢˜", top_k=3)
       
       # 3. éªŒè¯
       assert len(results) > 0
       assert results[0].metadata['knowledge_type'] in ['local', 'global', 'bridge']
   ```

4. **æ€§èƒ½æµ‹è¯•**ï¼š
   ```python
   def test_indexing_performance():
       """æµ‹è¯•ç´¢å¼•æ„å»ºæ€§èƒ½"""
       start = time.time()
       indexer.build_index(large_documents)
       duration = time.time() - start
       
       # éªŒè¯æ€§èƒ½æŒ‡æ ‡
       assert duration < 300  # 5åˆ†é’Ÿå†…å®Œæˆ
       assert get_memory_usage() < 2 * 1024 * 1024 * 1024  # < 2GB
   ```

5. **å›å½’æµ‹è¯•**ï¼š
   ```python
   def test_backward_compatibility():
       """æµ‹è¯•å‘åå…¼å®¹æ€§"""
       # ç¡®ä¿ HiRAG é›†æˆä¸ç ´åç°æœ‰åŠŸèƒ½
       old_results = traditional_retrieval(query)
       new_results = hirag_retrieval(query)
       
       # æ–°ç³»ç»Ÿåº”è¯¥æ›´å¥½æˆ–è‡³å°‘ä¸å·®
       assert new_results.quality >= old_results.quality * 0.95
   ```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] LLM Mock æ­£å¸¸å·¥ä½œï¼Œæµ‹è¯•æ— éœ€çœŸå®è°ƒç”¨
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] CI/CD é›†æˆ

**é¢„è®¡å·¥æ—¶**ï¼š2 å¤©

---

### P1-2: å¢é‡ç´¢å¼•ä¸æ™ºèƒ½ç¼“å­˜
**ç›®æ ‡**ï¼šä¼˜åŒ–ç´¢å¼•æ„å»ºæ€§èƒ½ï¼Œé™ä½ LLM è°ƒç”¨æˆæœ¬

**è¯¦ç»†éœ€æ±‚**ï¼š
- å®ç°å¢é‡ç´¢å¼•ï¼š
  - åŸºäºå†…å®¹å“ˆå¸Œæ£€æµ‹æ–‡æ¡£å˜åŒ–ï¼ˆSHA256ï¼‰
  - åªå¯¹æ–°å¢/ä¿®æ”¹æ–‡æ¡£é‡å»ºç´¢å¼•
  - ä¿ç•™æœªå˜åŒ–æ–‡æ¡£çš„ç´¢å¼•
- å®ç°æ™ºèƒ½ç¼“å­˜ï¼š
  - ç¼“å­˜ global æ‘˜è¦ï¼ˆé¿å…é‡å¤ç”Ÿæˆï¼‰
  - ç¼“å­˜ bridge çŸ¥è¯†
  - åŸºäºå†…å®¹å“ˆå¸Œçš„ç¼“å­˜é”®ï¼ˆæ–‡æ¡£æ›´æ–°æ—¶è‡ªåŠ¨å¤±æ•ˆï¼‰
  - è®¾ç½® TTLï¼ˆé»˜è®¤ 24 å°æ—¶ï¼‰
- æ·»åŠ é…ç½®é¡¹ï¼š
  ```python
  enable_incremental_indexing: bool = True
  index_cache_path: str = "./hirag_cache"
  cache_ttl_hours: int = 24
  cache_strategy: str = "content_hash"  # content_hash/ttl/hybrid
  ```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å¢é‡ç´¢å¼•æ­£å¸¸å·¥ä½œ
- [ ] ç¼“å­˜å‘½ä¸­ç‡ > 80%
- [ ] ç´¢å¼•æ„å»ºæ—¶é—´å‡å°‘ 60%+
- [ ] LLM è°ƒç”¨æ¬¡æ•°å‡å°‘ 70%+
- [ ] æ–‡æ¡£æ›´æ–°æ—¶ç¼“å­˜æ­£ç¡®å¤±æ•ˆ

**é¢„è®¡å·¥æ—¶**ï¼š2 å¤©

---

### P1-3: ç»†ç²’åº¦é”™è¯¯å¤„ç†
**ç›®æ ‡**ï¼šæé«˜ç³»ç»Ÿç¨³å®šæ€§å’Œå¯è°ƒè¯•æ€§

**è¯¦ç»†éœ€æ±‚**ï¼š
- å®ç°é™çº§ç­–ç•¥ï¼š
  - HiRAG ç´¢å¼•å¤±è´¥ â†’ é™çº§åˆ°ä¼ ç»Ÿæ··åˆæ£€ç´¢
  - HiRAG æ£€ç´¢è¶…æ—¶ â†’ é™çº§åˆ°å‘é‡æ£€ç´¢
  - Bridge å±‚æ„å»ºå¤±è´¥ â†’ åªä½¿ç”¨ local + global
- æ·»åŠ é…ç½®é¡¹ï¼š
  ```python
  enable_fallback: bool = True
  fallback_on_timeout: bool = True
  fallback_timeout_seconds: int = 5
  enable_lite_mode: bool = False  # ç®€åŒ–æ¨¡å¼
  ```
- é™çº§æ—¶è®°å½•æ—¥å¿—å¹¶æç¤ºç”¨æˆ·
- æä¾›æ‰‹åŠ¨åˆ‡æ¢é™çº§æ¨¡å¼çš„é€‰é¡¹

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å„ç§å¼‚å¸¸åœºæ™¯èƒ½æ­£ç¡®é™çº§
- [ ] é™çº§ä¸å½±å“ç”¨æˆ·ä½“éªŒ
- [ ] é™çº§åŸå› æœ‰æ¸…æ™°æ—¥å¿—
- [ ] å¯æ‰‹åŠ¨æ§åˆ¶é™çº§è¡Œä¸º

**é¢„è®¡å·¥æ—¶**ï¼š1.5 å¤©

---

### P1-3: æ–‡æ¡£ç±»å‹è‡ªåŠ¨è¯†åˆ«ä¸é€‚é…
**ç›®æ ‡**ï¼šé’ˆå¯¹ä¸åŒæ–‡æ¡£ç±»å‹ä¼˜åŒ– HiRAG é…ç½®

**è¯¦ç»†éœ€æ±‚**ï¼š
- å®ç°æ–‡æ¡£ç±»å‹è¯†åˆ«ï¼š
  - æ”¿ç­–æ³•è§„ï¼šè¯†åˆ«ç« èŠ‚ã€æ¡æ¬¾ã€é™„ä»¶ç»“æ„
  - è´¢åŠ¡æŠ¥å‘Šï¼šè¯†åˆ«è¡¨æ ¼ã€å›¾è¡¨ã€æ•°æ®
  - æŠ€æœ¯æ–‡æ¡£ï¼šè¯†åˆ«ä»£ç å—ã€API æ–‡æ¡£
  - é€šç”¨æ–‡æ¡£ï¼šé»˜è®¤é…ç½®
- ä¸ºæ¯ç§ç±»å‹é¢„è®¾æœ€ä½³é…ç½®ï¼š
  ```python
  POLICY_CONFIG = {
      'enable_section_hierarchy': True,
      'extract_clause_relations': True,
      'global_weight': 0.4,
      'bridge_weight': 0.4
  }
  
  FINANCIAL_CONFIG = {
      'enable_table_extraction': True,
      'table_as_bridge': True,
      'local_weight': 0.5
  }
  ```
- UI æ”¯æŒæ‰‹åŠ¨é€‰æ‹©æ–‡æ¡£ç±»å‹
- è‡ªåŠ¨è¯†åˆ«å‡†ç¡®ç‡ > 85%

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ”¯æŒ 4+ ç§æ–‡æ¡£ç±»å‹
- [ ] è‡ªåŠ¨è¯†åˆ«å‡†ç¡®ç‡è¾¾æ ‡
- [ ] æ¯ç§ç±»å‹æœ‰ä¼˜åŒ–é…ç½®
- [ ] UI å¯æ‰‹åŠ¨é€‰æ‹©ç±»å‹

**é¢„è®¡å·¥æ—¶**ï¼š2 å¤©

---

### P1-4: æ£€ç´¢è·¯å¾„å¯è§†åŒ–
**ç›®æ ‡**ï¼šè®©ç”¨æˆ·ç†è§£ HiRAG çš„æ£€ç´¢è¿‡ç¨‹

**è¯¦ç»†éœ€æ±‚**ï¼š
- åœ¨èŠå¤©ç•Œé¢æ·»åŠ "æ£€ç´¢è¿‡ç¨‹è¯¦æƒ…"é¢æ¿
- ä½¿ç”¨ Mermaid å›¾è¡¨å±•ç¤ºæ£€ç´¢æµç¨‹ï¼š
  ```markdown
  graph TD
      A[ç”¨æˆ·æŸ¥è¯¢] --> B[å±€éƒ¨çŸ¥è¯†æ£€ç´¢]
      A --> C[å…¨å±€çŸ¥è¯†æ£€ç´¢]
      A --> D[æ¡¥æ¢çŸ¥è¯†æ£€ç´¢]
      B --> E[ç»“æœèåˆ]
      C --> E
      D --> E
      E --> F[è‡ªé€‚åº”è¿‡æ»¤]
      F --> G[æœ€ç»ˆç­”æ¡ˆ]
  ```
- å±•ç¤ºæ¯å±‚çš„è´¡çŒ®åº¦ï¼š
  - å±€éƒ¨è´¡çŒ®ï¼š40%
  - å…¨å±€è´¡çŒ®ï¼š35%
  - æ¡¥æ¢è´¡çŒ®ï¼š25%
- æ˜¾ç¤ºæ£€ç´¢è€—æ—¶åˆ†è§£

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å¯è§†åŒ–å›¾è¡¨æ¸…æ™°ç¾è§‚
- [ ] è´¡çŒ®åº¦è®¡ç®—å‡†ç¡®
- [ ] è€—æ—¶ç»Ÿè®¡ç²¾ç¡®
- [ ] å¯æŠ˜å /å±•å¼€

**é¢„è®¡å·¥æ—¶**ï¼š1 å¤©

---

### P1-5: çŸ¥è¯†æ¥æºæº¯æºåŠŸèƒ½
**ç›®æ ‡**ï¼šæä¾›è¯¦ç»†çš„çŸ¥è¯†æ¥æºä¿¡æ¯

**è¯¦ç»†éœ€æ±‚**ï¼š
- æ‰©å±• Document å…ƒæ•°æ®ï¼š
  ```python
  {
      'knowledge_type': 'global',
      'source_doc_id': 'policy_2024.pdf',
      'section_path': 'ç¬¬ä¸‰ç«  > ç¬¬2èŠ‚ > ç¬¬1æ¡',
      'page_number': 15,
      'related_chunks': ['chunk_123', 'chunk_456'],
      'confidence': 0.92
  }
  ```
- åœ¨ UI ä¸­å±•ç¤ºï¼š
  - ğŸ“„ æ¥æºæ–‡æ¡£
  - ğŸ“ å…·ä½“ä½ç½®ï¼ˆç« èŠ‚è·¯å¾„ã€é¡µç ï¼‰
  - ğŸ”— å…³è”å†…å®¹ï¼ˆç‚¹å‡»æŸ¥çœ‹ï¼‰
  - ğŸ“Š ç½®ä¿¡åº¦åˆ†æ•°
- æ”¯æŒ"æŸ¥çœ‹å®Œæ•´ä¸Šä¸‹æ–‡"åŠŸèƒ½

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å…ƒæ•°æ®å®Œæ•´å‡†ç¡®
- [ ] UI å±•ç¤ºæ¸…æ™°å‹å¥½
- [ ] å¯è·³è½¬åˆ°åŸæ–‡ä½ç½®
- [ ] å…³è”å†…å®¹å¯æŸ¥çœ‹

**é¢„è®¡å·¥æ—¶**ï¼š1.5 å¤©

**P1 æ€»è®¡å·¥æ—¶**ï¼š8 å¤©

---

## ğŸ¨ P2 çº§éœ€æ±‚ï¼ˆä½“éªŒä¼˜åŒ– - å¯é€‰å®ç°ï¼‰

### P2-1: æ£€ç´¢è´¨é‡è¯„ä¼°ç³»ç»Ÿ
**ç›®æ ‡**ï¼šè‡ªåŠ¨è¯„ä¼°æ£€ç´¢ç»“æœè´¨é‡

**è¯¦ç»†éœ€æ±‚**ï¼š
- å®ç°è´¨é‡è¯„ä¼°æŒ‡æ ‡ï¼š
  - è¦†ç›–åº¦ï¼ˆCoverageï¼‰ï¼šç»“æœæ˜¯å¦è¦†ç›–æŸ¥è¯¢æ„å›¾
  - å¤šæ ·æ€§ï¼ˆDiversityï¼‰ï¼šç»“æœæ˜¯å¦å¤šæ ·åŒ–
  - è¿è´¯æ€§ï¼ˆCoherenceï¼‰ï¼šç»“æœä¹‹é—´æ˜¯å¦è¿è´¯
  - å±‚çº§å¹³è¡¡ï¼ˆLayer Balanceï¼‰ï¼šä¸‰å±‚çŸ¥è¯†æ˜¯å¦å¹³è¡¡
- åœ¨ UI ä¸­å±•ç¤ºè´¨é‡åˆ†æ•°
- è´¨é‡ä½æ—¶ç»™å‡ºæ”¹è¿›å»ºè®®
- è®°å½•è´¨é‡æ•°æ®ç”¨äºä¼˜åŒ–

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] 4 ä¸ªæŒ‡æ ‡è®¡ç®—å‡†ç¡®
- [ ] è´¨é‡åˆ†æ•°ç›´è§‚å±•ç¤º
- [ ] ä½è´¨é‡æ—¶æœ‰å»ºè®®
- [ ] æ•°æ®å¯å¯¼å‡ºåˆ†æ

**é¢„è®¡å·¥æ—¶**ï¼š2 å¤©

---

### P2-2: A/B æµ‹è¯•æ¡†æ¶
**ç›®æ ‡**ï¼šå¯¹æ¯”ä¸åŒæ£€ç´¢ç­–ç•¥çš„æ•ˆæœ

**è¯¦ç»†éœ€æ±‚**ï¼š
- å®ç° A/B æµ‹è¯•æ¡†æ¶ï¼š
  - æ”¯æŒåŒæ—¶è¿è¡Œå¤šç§æ£€ç´¢ç­–ç•¥
  - è®°å½•æ¯æ¬¡æ£€ç´¢çš„é…ç½®å’Œç»“æœ
  - æ”¶é›†ç”¨æˆ·åé¦ˆï¼ˆğŸ‘/ğŸ‘Œ/ğŸ‘ï¼‰
- åœ¨ UI ä¸­æ·»åŠ åé¦ˆæŒ‰é’®
- ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Šï¼š
  - å„ç­–ç•¥çš„å¹³å‡è´¨é‡åˆ†æ•°
  - ç”¨æˆ·æ»¡æ„åº¦
  - å“åº”æ—¶é—´
  - æˆæœ¬å¯¹æ¯”
- å¯¼å‡ºæµ‹è¯•æ•°æ®

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å¯åŒæ—¶æµ‹è¯•å¤šç§ç­–ç•¥
- [ ] ç”¨æˆ·åé¦ˆæ”¶é›†å®Œæ•´
- [ ] å¯¹æ¯”æŠ¥å‘Šæ¸…æ™°
- [ ] æ•°æ®å¯å¯¼å‡º

**é¢„è®¡å·¥æ—¶**ï¼š2.5 å¤©

---

### P2-3: æ™ºèƒ½é…ç½®æ¨è
**ç›®æ ‡**ï¼šæ ¹æ®æ–‡æ¡£ç‰¹å¾è‡ªåŠ¨æ¨èæœ€ä½³é…ç½®

**è¯¦ç»†éœ€æ±‚**ï¼š
- å®ç°é…ç½®æ¨èç®—æ³•ï¼š
  ```python
  def recommend_hirag_config(doc_stats: dict) -> HiRAGConfig:
      if doc_stats['avg_section_length'] > 1000:
          # é•¿æ–‡æ¡£ï¼Œå¢åŠ  global æƒé‡
          return HiRAGConfig(global_weight=0.4)
      elif doc_stats['has_complex_structure']:
          # å¤æ‚ç»“æ„ï¼Œå¢åŠ  bridge æƒé‡
          return HiRAGConfig(bridge_weight=0.4)
      # ...
  ```
- åˆ†ææ–‡æ¡£ç‰¹å¾ï¼š
  - å¹³å‡ç« èŠ‚é•¿åº¦
  - ç»“æ„å¤æ‚åº¦
  - è¡¨æ ¼/å›¾è¡¨æ•°é‡
  - å¼•ç”¨å…³ç³»å¯†åº¦
- åœ¨ UI ä¸­å±•ç¤ºæ¨èé…ç½®
- æ”¯æŒä¸€é”®åº”ç”¨æ¨è

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ¨èç®—æ³•å‡†ç¡®ç‡ > 80%
- [ ] æ¨èç†ç”±æ¸…æ™°
- [ ] å¯ä¸€é”®åº”ç”¨
- [ ] å¯æ‰‹åŠ¨è°ƒæ•´

**é¢„è®¡å·¥æ—¶**ï¼š2 å¤©

---

### P2-4: æ€§èƒ½ç›‘æ§ä¸å‘Šè­¦
**ç›®æ ‡**ï¼šç›‘æ§ç³»ç»Ÿæ€§èƒ½ï¼ŒåŠæ—¶å‘ç°é—®é¢˜

**è¯¦ç»†éœ€æ±‚**ï¼š
- å®ç°æ€§èƒ½ç›‘æ§ï¼š
  - æ£€ç´¢å“åº”æ—¶é—´
  - ç´¢å¼•æ„å»ºæ—¶é—´
  - LLM è°ƒç”¨æ¬¡æ•°å’Œè€—æ—¶
  - ç¼“å­˜å‘½ä¸­ç‡
  - å†…å­˜ä½¿ç”¨æƒ…å†µ
- æ·»åŠ å‘Šè­¦æœºåˆ¶ï¼š
  - æ…¢æŸ¥è¯¢å‘Šè­¦ï¼ˆ> 3sï¼‰
  - ä½è´¨é‡ç»“æœå‘Šè­¦
  - é«˜æˆæœ¬å‘Šè­¦
- åœ¨ UI ä¸­å±•ç¤ºç›‘æ§é¢æ¿
- å¯¼å‡ºæ€§èƒ½æŠ¥å‘Š

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å…³é”®æŒ‡æ ‡ç›‘æ§å®Œæ•´
- [ ] å‘Šè­¦åŠæ—¶å‡†ç¡®
- [ ] ç›‘æ§é¢æ¿æ¸…æ™°
- [ ] æŠ¥å‘Šå¯å¯¼å‡º

**é¢„è®¡å·¥æ—¶**ï¼š2.5 å¤©

**P2 æ€»è®¡å·¥æ—¶**ï¼š9 å¤©

---

## ğŸ¢ P3 çº§éœ€æ±‚ï¼ˆä¼ä¸šçº§ç‰¹æ€§ - æŒ‰éœ€å®ç°ï¼‰

### P3-1: å¤šç§Ÿæˆ·æ”¯æŒ
**ç›®æ ‡**ï¼šæ”¯æŒå¤šä¸ªç§Ÿæˆ·ç‹¬ç«‹ä½¿ç”¨ç³»ç»Ÿ

**è¯¦ç»†éœ€æ±‚**ï¼š
- ç§Ÿæˆ·éš”ç¦»ï¼š
  - ç‹¬ç«‹çš„ç´¢å¼•å­˜å‚¨
  - ç‹¬ç«‹çš„é…ç½®
  - ç‹¬ç«‹çš„ä½¿ç”¨ç»Ÿè®¡
- ç§Ÿæˆ·ç®¡ç†ï¼š
  - åˆ›å»º/åˆ é™¤ç§Ÿæˆ·
  - é…é¢ç®¡ç†
  - ä½¿ç”¨é‡ç»Ÿè®¡
- åœ¨ UI ä¸­æ·»åŠ ç§Ÿæˆ·åˆ‡æ¢

**é¢„è®¡å·¥æ—¶**ï¼š3 å¤©

---

### P3-2: æƒé™æ§åˆ¶ç³»ç»Ÿ
**ç›®æ ‡**ï¼šæ§åˆ¶ç”¨æˆ·å¯¹æ–‡æ¡£çš„è®¿é—®æƒé™

**è¯¦ç»†éœ€æ±‚**ï¼š
- å®ç°æƒé™æ§åˆ¶ï¼š
  - æ–‡æ¡£çº§æƒé™
  - ç« èŠ‚çº§æƒé™ï¼ˆå¯é€‰ï¼‰
  - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰
- æ£€ç´¢æ—¶è‡ªåŠ¨è¿‡æ»¤æ— æƒé™å†…å®¹
- åœ¨ UI ä¸­å±•ç¤ºæƒé™ä¿¡æ¯

**é¢„è®¡å·¥æ—¶**ï¼š3 å¤©

---

### P3-3: å®¡è®¡æ—¥å¿—
**ç›®æ ‡**ï¼šè®°å½•æ‰€æœ‰å…³é”®æ“ä½œ

**è¯¦ç»†éœ€æ±‚**ï¼š
- è®°å½•æ“ä½œæ—¥å¿—ï¼š
  - æ£€ç´¢æ“ä½œï¼ˆæŸ¥è¯¢ã€ç»“æœã€ç”¨æˆ·ï¼‰
  - ç´¢å¼•æ“ä½œï¼ˆæ„å»ºã€æ›´æ–°ã€åˆ é™¤ï¼‰
  - é…ç½®å˜æ›´
  - æƒé™å˜æ›´
- æ—¥å¿—æŸ¥è¯¢å’Œå¯¼å‡º
- åˆè§„æ€§æŠ¥å‘Šç”Ÿæˆ

**é¢„è®¡å·¥æ—¶**ï¼š2 å¤©

**P3 æ€»è®¡å·¥æ—¶**ï¼š8 å¤©

---

## ğŸ“Š æ€»ä½“è§„åˆ’ï¼ˆv2.0 æ›´æ–°ï¼‰

### å·¥æ—¶ç»Ÿè®¡
- **P0ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰**ï¼š9.5 å¤©ï¼ˆv1: 5.5å¤© â†’ v2: 9.5å¤©ï¼Œ+4å¤©ï¼‰
  - P0-0: æ¶æ„é‡æ„ (1.5å¤©)
  - P0-1: é…ç½®ç®¡ç† (0.5å¤©)
  - P0-2: HiRAG é€‚é…å™¨ (1å¤©)
  - P0-3: å±‚æ¬¡åŒ–ç´¢å¼•å™¨ (1.5å¤©)
  - P0-4: æ··åˆæ£€ç´¢æ‰©å±• (1å¤©)
  - P0-5: **æ™ºèƒ½è·¯ç”±ç³»ç»Ÿ** (2å¤©) â­
  - P0-6: UI ç®€åŒ– (0.5å¤©)
  - P0-7: å¼‚æ­¥ç´¢å¼•æ„å»º (1.5å¤©)
  - P0-8: æˆæœ¬æ§åˆ¶ (1å¤©)
  - P0-9: ç»“æœå±•ç¤ºä¼˜åŒ– (0.5å¤©)

- **P1ï¼ˆé‡è¦ä¼˜åŒ–ï¼‰**ï¼š8 å¤©
  - P1-1: æµ‹è¯•æ¡†æ¶ (2å¤©) â­
  - P1-2: å¢é‡ç´¢å¼•ä¸æ™ºèƒ½ç¼“å­˜ (2å¤©)
  - P1-3: ç»†ç²’åº¦é”™è¯¯å¤„ç† (1.5å¤©)
  - P1-4: æ–‡æ¡£ç±»å‹è¯†åˆ« (2å¤©)
  - P1-5: æ£€ç´¢è·¯å¾„å¯è§†åŒ– (1å¤©)

- **P2ï¼ˆä½“éªŒä¼˜åŒ–ï¼‰**ï¼š9 å¤©
- **P3ï¼ˆä¼ä¸šç‰¹æ€§ï¼‰**ï¼š8 å¤©
- **æ€»è®¡**ï¼š34.5 å¤©ï¼ˆv1: 30.5å¤© â†’ v2: 34.5å¤©ï¼‰

### v2.0 æ ¸å¿ƒæ”¹è¿›

**ç›¸æ¯” v1.0 çš„å…³é”®å˜åŒ–**ï¼š
1. âœ… **æ¶æ„é‡æ„**ï¼šé¿å…ç´¢å¼•å†—ä½™ï¼ŒèŠ‚çœ 50% å­˜å‚¨ç©ºé—´
2. âœ… **æ™ºèƒ½è·¯ç”±**ï¼šç”¨æˆ·æ“ä½œæ­¥éª¤å‡å°‘ 80%ï¼Œè‡ªåŠ¨åŒ¹é…æœ€ä½³ç­–ç•¥
3. âœ… **å¼‚æ­¥æ„å»º**ï¼šå¤§æ–‡æ¡£ä¸é˜»å¡ UIï¼Œç”¨æˆ·ä½“éªŒæå‡ 10x
4. âœ… **æˆæœ¬æ§åˆ¶**ï¼šLLM æˆæœ¬å¯é¢„æµ‹ã€å¯æ§åˆ¶
5. âœ… **æµ‹è¯•ä¿éšœ**ï¼š80% æµ‹è¯•è¦†ç›–ç‡ï¼Œè´¨é‡æœ‰ä¿éšœ

### å®æ–½å»ºè®®

**ç¬¬ä¸€é˜¶æ®µï¼ˆMVPï¼‰**ï¼šP0 å…¨éƒ¨å®Œæˆ
- æ—¶é—´ï¼š2 å‘¨
- ç›®æ ‡ï¼šåŸºç¡€ HiRAG åŠŸèƒ½å¯ç”¨ + æ™ºèƒ½è·¯ç”±
- éªŒæ”¶ï¼š
  - [ ] èƒ½å¤Ÿä¸Šä¼ æ–‡æ¡£ã€å¼‚æ­¥æ„å»ºç´¢å¼•ã€æ‰§è¡Œæ£€ç´¢
  - [ ] æ™ºèƒ½è·¯ç”±æ­£å¸¸å·¥ä½œï¼Œç”¨æˆ·æ— éœ€æ‰‹åŠ¨é…ç½®
  - [ ] æˆæœ¬å¯æ§ï¼Œæœ‰é¢„ç®—å‘Šè­¦
  - [ ] æ¶æ„æ¸…æ™°ï¼Œæ— ç´¢å¼•å†—ä½™

**ç¬¬äºŒé˜¶æ®µï¼ˆä¼˜åŒ–ï¼‰**ï¼šP1 é€‰æ‹©æ€§å®ç°
- æ—¶é—´ï¼š2 å‘¨
- ä¼˜å…ˆçº§ï¼šP1-1ï¼ˆæµ‹è¯•ï¼‰> P1-2ï¼ˆç¼“å­˜ï¼‰> P1-3ï¼ˆé”™è¯¯å¤„ç†ï¼‰> P1-4 > P1-5
- ç›®æ ‡ï¼šæå‡æ€§èƒ½ã€ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒ
- éªŒæ”¶ï¼š
  - [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%
  - [ ] ç¼“å­˜å‘½ä¸­ç‡ > 80%ï¼Œæˆæœ¬é™ä½ 70%
  - [ ] é”™è¯¯å¤„ç†å®Œå–„ï¼Œé™çº§ç­–ç•¥ç”Ÿæ•ˆ

**ç¬¬ä¸‰é˜¶æ®µï¼ˆå®Œå–„ï¼‰**ï¼šP2 æŒ‰éœ€å®ç°
- æ—¶é—´ï¼š2-3 å‘¨
- æ ¹æ®å®é™…ä½¿ç”¨åé¦ˆé€‰æ‹©å®ç°
- ç›®æ ‡ï¼šæ‰“ç£¨äº§å“ä½“éªŒï¼Œæ•°æ®é©±åŠ¨ä¼˜åŒ–

**ç¬¬å››é˜¶æ®µï¼ˆä¼ä¸šåŒ–ï¼‰**ï¼šP3 æŒ‰éœ€å®ç°
- æ—¶é—´ï¼š1-2 å‘¨
- æ ¹æ®å•†ä¸šéœ€æ±‚å†³å®š
- ç›®æ ‡ï¼šæ»¡è¶³ä¼ä¸šçº§åº”ç”¨éœ€æ±‚

---

## ğŸ”§ æŠ€æœ¯å‡†å¤‡

### ç¯å¢ƒå‡†å¤‡
1. å®‰è£… HiRAGï¼š
   ```bash
   cd /path/to/your/project
   git clone https://github.com/hhy-huang/HiRAG.git
   cd HiRAG
   pip install -e .
   ```

2. é…ç½® API Keyï¼ˆåœ¨ `.env` ä¸­ï¼‰ï¼š
   ```
   EMBED_BASE_URL=...
   EMBED_API_KEY=...
   CHAT_BASE_URL=...
   CHAT_API_KEY=...
   ```

### ä¾èµ–å…³ç³»
```
P0-1 (é…ç½®) â†’ P0-2 (é€‚é…å™¨) â†’ P0-3 (ç´¢å¼•å™¨)
                â†“
            P0-4 (æ··åˆæ£€ç´¢)
                â†“
            P0-5 (UI) + P0-6 (ä¸Šä¼ ) + P0-7 (å±•ç¤º)
                â†“
            P1 çº§éœ€æ±‚ â†’ P2 çº§éœ€æ±‚ â†’ P3 çº§éœ€æ±‚
```

---

## ğŸ“ éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] æ‰€æœ‰ P0 éœ€æ±‚å®ç°å¹¶é€šè¿‡æµ‹è¯•
- [ ] ä¸ç°æœ‰åŠŸèƒ½æ— å†²çª
- [ ] ç”¨æˆ·ç•Œé¢å‹å¥½ç›´è§‚
- [ ] æ–‡æ¡£å®Œæ•´ï¼ˆä»£ç æ³¨é‡Š + ä½¿ç”¨æ–‡æ¡£ï¼‰

### æ€§èƒ½éªŒæ”¶
- [ ] ç´¢å¼•æ„å»ºæ—¶é—´ < 5s/MB
- [ ] æ£€ç´¢å“åº”æ—¶é—´ < 2s
- [ ] å†…å­˜å ç”¨åˆç†ï¼ˆ< 2GBï¼‰
- [ ] ç¼“å­˜å‘½ä¸­ç‡ > 80%

### è´¨é‡éªŒæ”¶
- [ ] æ£€ç´¢å‡†ç¡®ç‡ > 85%
- [ ] ç³»ç»Ÿç¨³å®šæ€§ > 99%
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ—¥å¿—è®°å½•å®Œæ•´

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [HiRAG è®ºæ–‡](https://arxiv.org/abs/2503.10150)
- [HiRAG GitHub](https://github.com/hhy-huang/HiRAG)
- [smart-rag ç°æœ‰æ¶æ„æ–‡æ¡£](./README.md)

---

## ğŸ“ ç‰ˆæœ¬å†å²

### v2.0 (2026-01-22)
**é‡å¤§æ›´æ–°**ï¼šåŸºäºæ·±åº¦åæ€å’Œç”¨æˆ·éœ€æ±‚ï¼Œå…¨é¢ä¼˜åŒ–è®¾è®¡æ–¹æ¡ˆ

**æ–°å¢éœ€æ±‚**ï¼š
- â­ **P0-0**: æ¶æ„é‡æ„ - é¿å…ç´¢å¼•å†—ä½™ï¼Œå¤ç”¨ç°æœ‰å‘é‡ç´¢å¼•
- â­ **P0-5**: æ™ºèƒ½è·¯ç”±ç³»ç»Ÿ - è‡ªåŠ¨åŒ¹é…æœ€ä½³æ£€ç´¢ç­–ç•¥ï¼ˆè§£å†³é…ç½®å¤æ‚åº¦é—®é¢˜ï¼‰
- â­ **P0-7**: å¼‚æ­¥ç´¢å¼•æ„å»º - åå°ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸é˜»å¡ UI
- â­ **P0-8**: æˆæœ¬æ§åˆ¶ä¸ç›‘æ§ - LLM æˆæœ¬ä¼°ç®—ã€é¢„ç®—æ§åˆ¶
- â­ **P1-1**: æµ‹è¯•æ¡†æ¶ - å•å…ƒæµ‹è¯• + Mock + æ€§èƒ½æµ‹è¯•

**ä¼˜åŒ–æ”¹è¿›**ï¼š
- P0-1: é…ç½®ç®¡ç† - å¢åŠ æˆæœ¬æ§åˆ¶é…ç½®
- P0-2: HiRAG é€‚é…å™¨ - å¤ç”¨ç°æœ‰å‘é‡ç´¢å¼•
- P0-3: å±‚æ¬¡åŒ–ç´¢å¼•å™¨ - æ”¯æŒå¼‚æ­¥æ„å»º
- P0-6: UI ç®€åŒ– - é¢„è®¾æ¨¡å¼ + é«˜çº§é€‰é¡¹æŠ˜å 
- P0-9: ç»“æœå±•ç¤º - ç®€æ´æ¨¡å¼ + è¯¦ç»†æ¨¡å¼åˆ‡æ¢
- P1-2: å¢é‡ç´¢å¼• - åŸºäºå†…å®¹å“ˆå¸Œçš„æ™ºèƒ½ç¼“å­˜

**å…³é”®æŒ‡æ ‡**ï¼š
- ç”¨æˆ·æ“ä½œæ­¥éª¤å‡å°‘ 80%ï¼ˆæ™ºèƒ½è·¯ç”±ï¼‰
- å­˜å‚¨ç©ºé—´èŠ‚çœ 50%ï¼ˆæ¶æ„é‡æ„ï¼‰
- LLM æˆæœ¬é™ä½ 70%ï¼ˆæ™ºèƒ½ç¼“å­˜ï¼‰
- æµ‹è¯•è¦†ç›–ç‡ > 80%ï¼ˆæµ‹è¯•æ¡†æ¶ï¼‰

**å·¥æ—¶å˜åŒ–**ï¼š
- P0: 5.5å¤© â†’ 9.5å¤© (+4å¤©)
- æ€»è®¡: 30.5å¤© â†’ 34.5å¤© (+4å¤©)

---

### v1.0 (2026-01-22)
**åˆå§‹ç‰ˆæœ¬**ï¼šåŸºç¡€ HiRAG é›†æˆæ–¹æ¡ˆ

**åŒ…å«éœ€æ±‚**ï¼š
- P0: é…ç½®ç®¡ç†ã€HiRAG é€‚é…å™¨ã€å±‚æ¬¡åŒ–ç´¢å¼•å™¨ã€æ··åˆæ£€ç´¢ã€UI é›†æˆ
- P1: å¢é‡ç´¢å¼•ã€é™çº§ç­–ç•¥ã€æ–‡æ¡£ç±»å‹é€‚é…ã€å¯è§†åŒ–ã€æº¯æº
- P2: è´¨é‡è¯„ä¼°ã€A/B æµ‹è¯•ã€æ™ºèƒ½æ¨èã€æ€§èƒ½ç›‘æ§
- P3: å¤šç§Ÿæˆ·ã€æƒé™æ§åˆ¶ã€å®¡è®¡æ—¥å¿—

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹æŒ‡å—

### å¯¹äºå¼€å‘è€…

**ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡**
```bash
# å…‹éš† HiRAG
git clone https://github.com/hhy-huang/HiRAG.git
cd HiRAG && pip install -e .

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å…¥ API Keys
```

**ç¬¬äºŒæ­¥ï¼šå®æ–½ P0-0ï¼ˆæ¶æ„é‡æ„ï¼‰**
- é˜…è¯»æ¶æ„è®¾è®¡ï¼Œç†è§£çŸ¥è¯†å±‚æ¥å£
- åˆ›å»º `src/rag/indexer/` ç›®å½•
- å®ç° `KnowledgeLayer` åŸºç±»

**ç¬¬ä¸‰æ­¥ï¼šæŒ‰é¡ºåºå®æ–½ P0-1 åˆ° P0-9**
- æ¯å®Œæˆä¸€ä¸ªéœ€æ±‚ï¼Œè¿è¡Œæµ‹è¯•éªŒè¯
- æ›´æ–°æ–‡æ¡£ï¼Œæ ‡è®°å®ŒæˆçŠ¶æ€

### å¯¹äºäº§å“ç»ç†

**å…³æ³¨é‡ç‚¹**ï¼š
1. **P0-5 æ™ºèƒ½è·¯ç”±**ï¼šè¿™æ˜¯æœ€å¤§çš„ç”¨æˆ·ä½“éªŒæ”¹è¿›ï¼Œä¼˜å…ˆéªŒè¯
2. **P0-8 æˆæœ¬æ§åˆ¶**ï¼šç¡®ä¿ LLM æˆæœ¬å¯æ§
3. **P0-7 å¼‚æ­¥æ„å»º**ï¼šå¤§æ–‡æ¡£åœºæ™¯å¿…é¡»æµ‹è¯•

**éªŒæ”¶æ£€æŸ¥æ¸…å•**ï¼š
- [ ] ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£åï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®å³å¯è·å¾—å¥½çš„æ£€ç´¢ç»“æœ
- [ ] æˆæœ¬ä¼°ç®—å‡†ç¡®ï¼Œæœ‰é¢„ç®—å‘Šè­¦
- [ ] å¤§æ–‡æ¡£ï¼ˆ>10MBï¼‰ä¸é˜»å¡ç•Œé¢
- [ ] æ£€ç´¢ç»“æœå±•ç¤ºç®€æ´ï¼Œä¸ä¿¡æ¯è¿‡è½½

---

## ğŸ’¡ è®¾è®¡å“²å­¦

1. **ç”¨æˆ·è‡³ä¸Š**ï¼šæ™ºèƒ½è·¯ç”±è®©ç”¨æˆ·æ— éœ€ç†è§£æŠ€æœ¯ç»†èŠ‚
2. **æˆæœ¬å¯æ§**ï¼šæ¯ä¸€æ¬¡ LLM è°ƒç”¨éƒ½åº”è¯¥æ˜¯å¯é¢„æµ‹ã€å¯æ§åˆ¶çš„
3. **æ¸è¿›å¢å¼º**ï¼šHiRAG æ˜¯å¢å¼ºå±‚ï¼Œä¸æ˜¯æ›¿ä»£ç°æœ‰ç³»ç»Ÿ
4. **è´¨é‡ä¿éšœ**ï¼šæµ‹è¯•å…ˆè¡Œï¼Œè¦†ç›–ç‡ > 80%
5. **æ€§èƒ½ä¼˜å…ˆ**ï¼šå¼‚æ­¥æ„å»ºã€æ™ºèƒ½ç¼“å­˜ï¼Œç”¨æˆ·ä½“éªŒç¬¬ä¸€

---

**åˆ›å»ºæ—¶é—´**ï¼š2026-01-22  
**æœ€åæ›´æ–°**ï¼š2026-01-22 (v2.0)  
**ç»´æŠ¤è€…**ï¼šsmart-rag å›¢é˜Ÿ  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0
